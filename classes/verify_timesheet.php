<?phprequire_once("../config/db.php");session_start();include("../views/common.php");function verify() {    $year = date("Y");    $month = date("n");    $db_connection = new mysqli(DB_HOST, DB_USER, DB_PASS, DB_NAME);        $res = $db_connection->query("SELECT * from timesheet_info where emp_id = '". $_POST['show_btn']."' and month = '" . $month . "' and year = '".$year."';");    if( !$res )    {        $month--;        if( $month == 0 )        {            $month = 12;            $year--;        }                    $res = $db_connection->query("SELECT * from timesheet_info where emp_id = '". $_POST['show_btn']."' and month = '" . $month . "' and year = '".$year."';");    }        $info = $res->fetch_object();    if( $info->state == "APPROVE")        echo "Timesheetul a fost deja verificat";    else if ($info->state == "OPEN" || $info->state == "REJECT")        echo "Timesheetul inca nu a fost trimis spre verificare";        $first = $year . "-" . $month . "-" . 1;    $second = $year . "-" . ($month + 1) . "-" . 1;    $query_result = $db_connection->query("SELECT * FROM timesheet WHERE emp_id = '". $_POST['show_btn']."' and date between '". $first ."' and '". $second ."';");    $r = '';    $r .= '<div class="component">';	$r .= '  <table id="testTable" style="table-layout: fixed;">';	$r .= '   <thead>';    $r .= '    <tr style="background-color:#ccc;">';    $r .= '         <th width="100" style="text-align: center;">Data</th>';    $r .= '         <th width="100" style="text-align: center;">Ore lucrate</th>';    $r .= '         <th width="100" style="text-align: center;">Extra Ore</th>';    $r .= '         <th width="100" style="text-align: center;">Nume proiect</th>';    $r .= '         <th width="100" style="text-align: center;">Descrierea lucrului</th>';    $r .= '    </tr>';	$r .= '   </thead>';    while( $query_result && $timesheet = $query_result->fetch_object() )    {        $project_result = $db_connection->query("SELECT name FROM projects where id = '" . $timesheet->project_id . "';");        $project_name = $project_result->fetch_object();        $r .= ' <tr>';        $r .= '     <td style="text-align: center;>'. $timesheet->date .'</td>';        $r .= '     <td style="text-align: center;>'. $timesheet->hours .'</td>';        $r .= '     <td style="text-align: center;>'. $timesheet->extra_hours .'</td>';        $r .= '     <td style="text-align: center;>'. $project_name->name .'</td>';        $r .= '     <td style="text-align: center;>'. $timesheet->description .'</td>';        $r .= ' </tr>';    }    $r .= ' </table>';    return $r;}function buttons() {    $current_m = date("n");    $current_y = date("Y");    $db_connection = new mysqli(DB_HOST, DB_USER, DB_PASS, DB_NAME);    $query_result = $db_connection->query("SELECT * FROM timesheet_info         where emp_id = '" . $_POST['show_btn'] . "' and month='". $current_m ."' and year='". $current_y ."' ;");      if( !$query_result )    {        $current_m--;        if( $current_m == 0 )        {            $current_m = 12;            $current_y--;        }         $query_result = $db_connection->query("SELECT * FROM timesheet_info             where emp_id = '" . $_POST['show_btn'] . "' and month='". $current_m ."' and year='". $current_y ."' ;");    }    $obj = $query_result->fetch_object();    if(  $obj->state == "SUBMIT" )    {        $r = '';        $r .= '<td align="right">';        $r .= '    <textarea rows="1" cols="50" name = "reject_info"></textarea>';        $r .= '    <button name="approve_btn" type="submit" value="'.$_POST['show_btn'].'">Accepta</button>';        $r .= '    <button name="reject_btn" type="submit" value="'.$_POST['show_btn'].'">Rejecteaza</button>';        $r .= '</td>';        return $r;    }}?><form method="post" action="../classes/approve_reject_btns.php" name="forma">    <table>        <tr>            <td width = "800">                <?php echo verify(); ?>            </td>        </tr>        <tr>            <?php echo buttons(); ?>        </tr>    </table></form>